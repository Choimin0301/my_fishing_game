<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”¼ì…”ë§¨ íƒ€ì´ì¿¤ : ì¸í¬ë©”ì´ì…˜ ì—ë””ì…˜</title>
    <style>
        :root {
            --sky-day: #87CEEB; --sea-day: #1E90FF;
            --sky-night: #1a1a2e; --sea-night: #16213e;
        }
        body { font-family: 'Apple SD Gothic Neo', sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; transition: 1s; background: #f0f0f0; }
        .day-mode { --sky: var(--sky-day); --sea: var(--sea-day); --panel-bg: white; --text: black; }
        .night-mode { --sky: var(--sky-night); --sea: var(--sea-night); --panel-bg: #252545; --text: #e0e0e0; background: #0f0f1b; }

        #game-window { 
            position: relative; width: 480px; height: 320px; 
            background: linear-gradient(to bottom, var(--sky) 50%, var(--sea) 50%); 
            border: 4px solid #333; border-radius: 20px; overflow: hidden; cursor: pointer;
        }

        #fisherman { position: absolute; top: 35%; left: 30px; font-size: 65px; z-index: 2; transition: 0.3s; }
        #bobber { position: absolute; top: 55%; left: 240px; font-size: 25px; display: none; }
        #alert { position: absolute; top: 40%; left: 250px; font-size: 45px; display: none; animation: bounce 0.3s infinite alternate; }
        
        #gauge-box { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); width: 300px; display: none; background: white; padding: 5px; border-radius: 15px; border: 3px solid #333; z-index: 10; }
        #gauge-fill { height: 25px; width: 30%; background: linear-gradient(90deg, #00FF00, #32CD32); border-radius: 10px; }

        /* ê²°ê³¼ ì°½ íŒì—… */
        #result-popup { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            width: 200px; background: rgba(255,255,255,0.95); border: 3px solid #FF7F50;
            border-radius: 20px; text-align: center; padding: 15px; z-index: 100; transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            color: #333; box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        #result-popup.show { transform: translate(-50%, -50%) scale(1); }

        .container { width: 490px; margin-top: 15px; }
        .stats { background: var(--panel-bg); color: var(--text); padding: 12px; border-radius: 15px; display: flex; justify-content: space-around; font-weight: bold; border: 2px solid #ddd; margin-bottom: 10px; transition: 0.5s; }
        
        .grid-ui { display: grid; grid-template-columns: 180px 1fr; gap: 15px; }
        .panel { background: var(--panel-bg); color: var(--text); padding: 15px; border-radius: 15px; border: 2px solid #ddd; transition: 0.5s; }
        .panel h3 { margin: 0 0 10px 0; font-size: 16px; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        
        #collection-ui { 
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; 
            height: 220px; overflow-y: scroll; padding-right: 5px;
        }

        .fish-card { 
            text-align: center; padding: 10px; border: 1px solid #eee; 
            border-radius: 10px; background: rgba(127, 127, 127, 0.1); position: relative;
        }
        .fish-card.unknown { opacity: 0.3; filter: grayscale(1); }
        .fish-card .icon { font-size: 28px; display: block; }
        .fish-card .name { font-size: 11px; font-weight: bold; margin-top: 4px; display: block; }
        
        .info-icons { font-size: 9px; margin-top: 5px; color: #888; display: flex; flex-direction: column; gap: 2px; align-items: center; }
        .info-tag { background: rgba(0,0,0,0.1); padding: 1px 6px; border-radius: 4px; width: fit-content; }

        .btn-main { width: 100%; padding: 15px; font-size: 20px; border-radius: 15px; margin-bottom: 10px; border: none; background: #FF7F50; color: white; box-shadow: 0 5px #d45d31; cursor: pointer; font-weight: bold; }
        
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-15px); } }
    </style>
</head>
<body class="day-mode">

    <div id="game-window" onclick="onScreenClick()">
        <div id="gauge-box"><div id="gauge-fill"></div></div>
        <div id="fisherman">ğŸ£</div>
        <div id="bobber">ğŸ”´</div>
        <div id="alert">â—</div>
        
        <div id="result-popup">
            <div id="pop-title" style="font-size: 12px; color: #666;">ìƒˆë¡œìš´ ë¬¼ê³ ê¸°!</div>
            <div id="pop-icon" style="font-size: 50px; margin: 5px 0;">ğŸŸ</div>
            <div id="pop-name" style="font-size: 18px; font-weight: bold; color: #FF7F50;">ë©¸ì¹˜</div>
            <div id="pop-price" style="font-size: 14px; margin-bottom: 10px;">+10 G</div>
            <div id="pop-info" style="font-size: 10px; color: #888; border-top: 1px solid #eee; pt: 5px;">ğŸ“ì•ë°”ë‹¤ | â˜€ï¸ë‚®</div>
        </div>

        <div id="map-name" style="position:absolute; bottom:10px; right:20px; font-weight:bold; background:rgba(0,0,0,0.6); color:white; padding:5px 12px; border-radius:15px; font-size:12px;">í˜„ì¬: ì•ë°”ë‹¤</div>
    </div>

    <div class="container">
        <div class="stats">
            <span>ğŸ’° <span id="gold">0</span> G</span>
            <span>ğŸ’ª íŒŒì›Œ <span id="power-val">20</span></span>
            <span><span id="time-icon">â˜€ï¸</span> <span id="time-text">ë‚®</span></span>
        </div>

        <button id="start-btn" class="btn-main" onclick="startFishing()">ë‚šì‹œ ë˜ì§€ê¸°!</button>

        <div class="grid-ui">
            <div class="panel">
                <h3>ğŸ›’ ìƒì </h3>
                <div style="font-size: 12px; margin-bottom:10px;">ì¥ë¹„ ê°•í™” (+10) <button onclick="buyUpgrade('power')" style="width:100%; margin-top:5px; cursor:pointer; background:#FF7F50; color:white; border:none; padding:5px; border-radius:5px;">150 G</button></div>
                <div style="font-size: 12px;">ìƒˆ ë‚šì‹œí„°: í•´ìš´ëŒ€ <button id="map-unlock-btn" onclick="unlockMap(1)" style="width:100%; margin-top:5px; cursor:pointer; background:#FF7F50; color:white; border:none; padding:5px; border-radius:5px;">500 G</button></div>
            </div>

            <div class="panel">
                <h3>ğŸŸ ë„ê° <small>(<span id="collect-count">0</span>/20)</small></h3>
                <div id="collection-ui"></div>
            </div>
        </div>
    </div>

    <script>
        let gold = 0, power = 20, gameState = "IDLE", currentMap = 0;
        let isNight = false, reelProgress = 30;

        const maps = [
            { name: "ì•ë°”ë‹¤", cost: 0, unlocked: true },
            { name: "í•´ìš´ëŒ€", cost: 500, unlocked: false }
        ];

        const fishes = [
            { name: "ë©¸ì¹˜", price: 10, prob: 0.5, icon: "ğŸŸ", maps: [0], time: 0 },
            { name: "ë‚˜ë¹„ê³ ê¸°", price: 30, prob: 0.6, icon: "ğŸ ", maps: [0], time: 1 },
            { name: "ì˜¤ì§•ì–´", price: 50, prob: 0.7, icon: "ğŸ¦‘", maps: [0, 1], time: 2 },
            { name: "ê½ƒê²Œ", price: 40, prob: 0.6, icon: "ğŸ¦€", maps: [0], time: 0 },
            { name: "ë³µì–´", price: 70, prob: 0.5, icon: "ğŸ¡", maps: [0], time: 1 },
            { name: "ì „ì–´", price: 35, prob: 0.6, icon: "ğŸŸ", maps: [0], time: 1 },
            { name: "ì•„ê·€", price: 150, prob: 0.8, icon: "ğŸ®", maps: [1], time: 2 },
            { name: "ê³ ë“±ì–´", price: 90, prob: 0.6, icon: "ğŸŸ", maps: [1], time: 1 },
            { name: "ê°ˆì¹˜", price: 130, prob: 0.7, icon: "ğŸ—¡ï¸", maps: [1], time: 2 },
            { name: "ë¬¸ì–´", price: 200, prob: 0.8, icon: "ğŸ™", maps: [1], time: 0 },
            { name: "ìƒì–´", price: 1500, prob: 0.98, icon: "ğŸ¦ˆ", maps: [1], time: 2 },
            { name: "í•´ë§ˆ", price: 400, prob: 0.8, icon: "ğŸ´", maps: [1], time: 1 },
            { name: "ê°€ì˜¤ë¦¬", price: 350, prob: 0.7, icon: "ğŸª", maps: [1], time: 0 },
            { name: "ë„™ì¹˜", price: 110, prob: 0.6, icon: "ğŸ ", maps: [0, 1], time: 0 },
            { name: "í•´íŒŒë¦¬", price: 80, prob: 0.5, icon: "ğŸ‘¾", maps: [0, 1], time: 2 },
            { name: "ì°¸ë”", price: 250, prob: 0.8, icon: "ğŸŸ", maps: [1], time: 1 },
            { name: "í™©ê¸ˆì‰ì–´", price: 3000, prob: 0.99, icon: "âœ¨", maps: [0, 1], time: 0 },
            { name: "ê³ ë˜", price: 7000, prob: 1.0, icon: "ğŸ³", maps: [1], time: 1 },
            { name: "ì‹¬í•´ì¥ì–´", price: 600, prob: 0.9, icon: "ğŸ", maps: [1], time: 2 },
            { name: "ë°”ë‹¤ê±°ë¶", price: 1000, prob: 0.95, icon: "ğŸ¢", maps: [1], time: 0 }
        ];

        fishes.forEach((f, i) => { f.id = i; f.count = 0; });

        setInterval(() => {
            isNight = !isNight;
            document.body.className = isNight ? "night-mode" : "day-mode";
            document.getElementById('time-text').innerText = isNight ? "ë°¤" : "ë‚®";
            document.getElementById('time-icon').innerText = isNight ? "ğŸŒ™" : "â˜€ï¸";
        }, 20000);

        function renderCollection() {
            const ui = document.getElementById('collection-ui');
            ui.innerHTML = '';
            fishes.forEach(f => {
                const isFound = f.count > 0;
                const timeStr = f.time === 0 ? "ì¢…ì¼" : (f.time === 1 ? "ë‚®" : "ë°¤");
                const mapStr = f.maps.map(mIdx => maps[mIdx].name).join('/');
                
                ui.innerHTML += `
                    <div class="fish-card ${isFound ? '' : 'unknown'}">
                        <span class="icon">${isFound ? f.icon : 'â“'}</span>
                        <span class="name">${isFound ? f.name : '???'}</span>
                        <div class="info-icons">
                            <span class="info-tag">${mapStr}</span>
                            <span class="info-tag">${timeStr} ì¶œí˜„</span>
                            <span class="info-tag">${f.count}íšŒ íšë“</span>
                        </div>
                    </div>`;
            });
            document.getElementById('collect-count').innerText = fishes.filter(f => f.count > 0).length;
        }

        function startFishing() {
            if (gameState !== "IDLE") return;
            gameState = "WAITING";
            document.getElementById('start-btn').disabled = true;
            document.getElementById('bobber').style.display = "block";
            document.getElementById('alert').style.display = "none";
            document.getElementById('result-popup').classList.remove('show');
            
            setTimeout(() => {
                if(gameState === "WAITING") {
                    gameState = "BITE";
                    document.getElementById('alert').style.display = "block";
                    document.getElementById('bobber').style.top = "60%";
                    setTimeout(() => { if(gameState === "BITE") finish(false); }, 1000);
                }
            }, 1000 + Math.random()*2000);
        }

        function onScreenClick() {
            if (gameState === "BITE") {
                gameState = "REELING";
                document.getElementById('alert').style.display = "none";
                document.getElementById('gauge-box').style.display = "block";
                reelProgress = 30;
                startReeling();
            } else if (gameState === "REELING") {
                reelProgress += power;
                if(reelProgress >= 100) finish(true);
                document.getElementById('gauge-fill').style.width = reelProgress + "%";
            }
        }

        function startReeling() {
            let loop = setInterval(() => {
                if(gameState !== "REELING") { clearInterval(loop); return; }
                reelProgress -= 2.5;
                document.getElementById('gauge-fill').style.width = reelProgress + "%";
                if(reelProgress <= 0) finish(false);
            }, 50);
        }

        function finish(success) {
            gameState = "IDLE";
            document.getElementById('gauge-box').style.display = "none";
            document.getElementById('bobber').style.display = "none";
            document.getElementById('bobber').style.top = "55%";
            document.getElementById('start-btn').disabled = false;

            if (success) {
                const currentTimeType = isNight ? 2 : 1;
                const available = fishes.filter(f => f.maps.includes(currentMap) && (f.time === 0 || f.time === currentTimeType));
                const fish = available.find(f => Math.random() <= f.prob) || available[0];
                
                gold += fish.price;
                fish.count++;
                
                // ê²°ê³¼ íŒì—… í‘œì‹œ
                showPopup(fish);
                renderCollection();
            }
            updateUI();
        }

        function showPopup(fish) {
            const popup = document.getElementById('result-popup');
            const timeStr = fish.time === 0 ? "ì¢…ì¼" : (fish.time === 1 ? "â˜€ï¸ë‚®" : "ğŸŒ™ë°¤");
            const mapStr = fish.maps.map(mIdx => maps[mIdx].name).join('/');
            
            document.getElementById('pop-icon').innerText = fish.icon;
            document.getElementById('pop-name').innerText = fish.name;
            document.getElementById('pop-price').innerText = `+${fish.price} G`;
            document.getElementById('pop-info').innerText = `${mapStr} | ${timeStr}`;
            
            popup.classList.add('show');
            setTimeout(() => { popup.classList.remove('show'); }, 2500);
        }

        function buyUpgrade(type) {
            if (gold >= 150) { gold -= 150; power += 10; updateUI(); }
            else { alert("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!"); }
        }

        function unlockMap(id) {
            if (currentMap === id) return;
            if (gold >= 500 || maps[id].unlocked) {
                if (!maps[id].unlocked) { gold -= 500; maps[id].unlocked = true; }
                currentMap = id;
                document.getElementById('map-name').innerText = "í˜„ì¬: " + maps[id].name;
                document.getElementById('map-unlock-btn').innerText = maps[id].name + " ì´ë™ ì¤‘";
            } else { alert("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!"); }
            updateUI();
        }

        function updateUI() {
            document.getElementById('gold').innerText = gold;
            document.getElementById('power-val').innerText = power;
        }

        renderCollection();
    </script>
</body>
</html>